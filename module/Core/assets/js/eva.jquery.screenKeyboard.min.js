(function(e){var b={connectTo:null,keyboardSelector:null,offsetX:0,offsetY:0,callback:function(){}},a=null,f=null,d=null,c={init:function(h){if(this===c){return false}var g=c.getOptions(h);f=e(this);a=e(g.keyboardSelector);d=e(g.connectTo);d.on("click",c.events.onClickConnectHandler);a.find("tbody a").on("click",c.events.onClickKey);a.find("thead .tojiru").on("click",c.events.onClickCloseKey);a.find("thead .hirakana").on("click",c.events.onClickHirakanaKey);a.find("thead .katagana").on("click",c.events.onClickKataganaKey);a.find("thead .switch_youon").on("click",c.events.onClickYouonKey);a.find("thead .switch_kana").on("click",c.events.onClickKanaKey);a.find("thead .back_space").on("click",c.events.onClickBackspaceKey);a.find("tr").find("td:gt(9)").hide();e(window).on("resize",c.events.onResizeWindow);return false},insertAtCaret:function(i){textarea=f[0];if(document.selection){textarea.focus();sel=document.selection.createRange();sel.text=i;textarea.focus()}else{if(textarea.selectionStart||textarea.selectionStart=="0"){var h=textarea.selectionStart;var g=textarea.selectionEnd;var j=textarea.scrollTop;textarea.value=textarea.value.substring(0,h)+i+textarea.value.substring(g,textarea.value.length);textarea.focus();textarea.selectionStart=h+i.length;textarea.selectionEnd=h+i.length;textarea.scrollTop=j}else{textarea.value+=i;textarea.focus()}}},deleteAtCaret:function(){textarea=f[0];if(textarea.selectionStart||textarea.selectionStart=="0"){var i=textarea.value.length;var h=textarea.selectionStart;var g=textarea.selectionEnd;var j=textarea.scrollTop;if(i===h){textarea.value=textarea.value.substring(0,i-1)}else{textarea.value=textarea.value.substring(0,h)+textarea.value.substring(g,textarea.value.length)}textarea.focus();textarea.selectionStart=h;textarea.selectionEnd=h;textarea.scrollTop=j}else{textarea.focus()}},resetKeyboardPosition:function(){var g=d.offset();a.css({top:g.top+d.outerHeight(),left:g.left-a.outerWidth()+35})},switchYouon:function(){a.find("tbody").each(function(){if(e(this).hasClass("youon")){e(this).find("tr").find("td:lt(10)").show();e(this).find("tr").find("td:gt(9)").hide();e(this).removeClass("youon")}else{e(this).find("tr").find("td:lt(10)").hide();e(this).find("tr").find("td:gt(9)").show();e(this).addClass("youon")}});c.resetKeyboardPosition()},hideKeyboard:function(){a.hide()},getOptions:function(g){var h=e.extend({},b);return e.extend(h,g)},effects:{},events:{onClickConnectHandler:function(){c.resetKeyboardPosition();a.is(":visible")?a.hide():a.show();return false},onClickYouonKey:function(){c.switchYouon();return false},onClickHirakanaKey:function(){a.find("tbody.hirakana").show();a.find("tbody.katagana").hide();return false},onClickKataganaKey:function(){a.find("tbody.katagana").show();a.find("tbody.hirakana").hide();return false},onResizeWindow:function(){c.resetKeyboardPosition()},onClickCloseKey:function(){a.hide();return false},onClickKanaKey:function(){var k=a.find("tbody.hirakana");var i=a.find("tbody.katagana");var h=e(this);var g=h.html();var j=h.attr("data-text");if(k.is(":visible")){k.hide();i.show()}else{i.hide();k.show()}h.html(j);h.attr("data-text",g);return false},onClickBackspaceKey:function(){c.deleteAtCaret();return false},onClickKey:function(){var g=e(this);c.insertAtCaret(g.html());return false}}};e.fn.screenKeyboard=function(g){if(c[g]){c.init();return c[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return c.init.apply(this,arguments)}else{e.error("Method "+g+" does not exist on jQuery.jpScreenKeyboard")}}return false};e.screenKeyboard=c})(jQuery);
