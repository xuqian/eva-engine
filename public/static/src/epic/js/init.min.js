eva.highlightmenu=function(){var a=eva.parseUri();var b=$("li[data-highlight-url]");var c=a.path;b.each(function(){var f=$(this);var g=f.attr("data-highlight-url");g=g.replace(/\//g,"\\/");var e=new RegExp(g);var d=e.exec(c);if(d){f.addClass("active");f.parent().removeClass("collapse");f.parent().parent().addClass("active");return true}})};eva.miniCalendar=function(){if(!$(".calendar-wrap")[0]){return false}var a=eva.d("/event/calendar/");$(".calendar-wrap").load(a);$(".calendar-wrap thead a").live("click",function(){$(".calendar-wrap").load($(this).attr("href"));return false})};eva.notice=function(){if(!$(".message-notice-count")[0]){return false}var a=function(){$.ajax({url:eva.d("/message/messages/unreadcount"),type:"get",dataType:"json",success:function(b){if(b.count>0){$(".message-notice-count .count-number").html(b.count).show();var c=$("title").text();if(c.match(/^\(\d+\)/)){c=c.replace(/^\(\d+\)/,"("+b.count+") ");$("title").html(c)}else{$("title").prepend("("+b.count+") ")}}else{$(".message-notice-count .count-number").hide();var c=$("title").text();if(c.match(/^\(\d+\)/)){c=c.replace(/^\(\d+\)/,"");$("title").html(c)}}}})};a();setInterval(function(){a()},50000)};eva.templates=function(){$("script[data-url]").each(function(){var b=$(this);var a=b.attr("data-url");$.ajax({url:a,dataType:"json",success:function(c){var d=tmpl(b.html(),c);b.after(d)}})})};eva.select2=function(){if(!$(".select2")[0]){return false}eva.loadcss(eva.s("/lib/js/jquery/jquery.select2/select2.css"));eva.loader(eva.s("/lib/js/jquery/jquery.select2/select2.js"),function(){$(".select2").select2()})};eva.checkFollow=function(){if(!$(".follow-check")[0]){return false}var b=$(".follow-check");var a=b.find("input[name=user_id]").val();var c=b.attr("data-url");$.ajax({url:c,dataType:"json",type:"get",data:{user_id:a},success:function(d){if(!d.item||d.item.length<1){return false}$(".follow-form").toggleClass("hide");$(".unfollow-form").toggleClass("hide")}})};eva.preview=function(){$(document).on("click",".item-preview",function(){var b=$(this);var a={url:b.attr("data-url"),width:b.attr("data-width"),height:b.attr("data-height")};if(b.hasClass("video")){b.html(eva.template('<embed src="{url}" quality="high" width="{width}" height="{height}" align="middle" allowScriptAccess="always" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>',a))}else{b.html(eva.template('<img class="img-polaroid" alt="" src="{url}" width="{width}" />',a))}b.off("click");return false})};eva.construct=function(){$("#lang").on("change",function(){window.location.href=$(this).val()});eva.highlightmenu();eva.miniCalendar();eva.notice();eva.select2();eva.checkFollow();eva.preview();var c=eva.config.lang;var a={en:"en",fr:"fr",zh:"zh_CN",zh_TW:"zh_TW",ja:"ja"};var b=a[c];eva.loader(eva.s("/lib/js/jquery/jquery.validationEngine/jquery.validationEngine-"+b+".js"),function(){$("form").validationEngine()});eva.loader(eva.s("/lib/js/jstemplates/tmpl.js"),function(){eva.templates()});return false};eva.destruct=function(){};
