eva.highlightmenu=function(){var a=eva.parseUri();var b=$("li[data-highlight-url]");var c=a.path;b.each(function(){var f=$(this);var g=f.attr("data-highlight-url");g=g.replace(/\//g,"\\/");var e=new RegExp(g);var d=e.exec(c);if(d){f.addClass("active");f.parent().removeClass("collapse");f.parent().parent().addClass("active");return true}})};eva.miniCalendar=function(){if(!$(".calendar-wrap")[0]){return false}var a=eva.d("/event/calendar/");$(".calendar-wrap").load(a);$(".calendar-wrap thead a").live("click",function(){$(".calendar-wrap").load($(this).attr("href"));return false})};eva.notice=function(){if(!$(".message-notice-count")[0]){return false}var a=function(){$.ajax({url:eva.d("/message/messages/unreadcount"),type:"get",dataType:"json",success:function(b){if(b.count>0){$(".message-notice-count .count-number").html(b.count).show();var c=$("title").text();if(c.match(/^\(\d+\)/)){c=c.replace(/^\(\d+\)/,"("+b.count+") ");$("title").html(c)}else{$("title").prepend("("+b.count+") ")}}else{$(".message-notice-count .count-number").hide();var c=$("title").text();if(c.match(/^\(\d+\)/)){c=c.replace(/^\(\d+\)/,"");$("title").html(c)}}}})};a();setInterval(function(){a()},50000)};eva.templates=function(){$("script[data-url]").each(function(){var b=$(this);var a=b.attr("data-url");$.ajax({url:a,dataType:"json",success:function(c){var d=tmpl(b.html(),c);b.after(d)}})})};eva.select2=function(){if(!$(".select2")[0]){return false}eva.loadcss(eva.s("/lib/js/jquery/jquery.select2/select2.css"));eva.loader(eva.s("/lib/js/jquery/jquery.select2/select2.js"),function(){$(".select2").select2()})};eva.checkFollow=function(){if(!$(".follow-check")[0]){return false}var b=$(".follow-check");var a=b.find("input[name=user_id]").val();var c=b.attr("data-url");$.ajax({url:c,dataType:"json",type:"get",data:{user_id:a},success:function(d){if(!d.item||d.item.length<1){return false}$(".follow-form").toggleClass("hide");$(".unfollow-form").toggleClass("hide")}})};eva.preview=function(){$(document).on("click",".item-preview",function(){var b=$(this);var a={url:b.attr("data-url"),width:b.attr("data-width"),height:b.attr("data-height")};if(b.hasClass("video")){b.html(eva.template('<embed src="{url}" quality="high" width="{width}" height="{height}" align="middle" allowScriptAccess="always" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>',a))}else{b.html(eva.template('<img class="img-polaroid" alt="" src="{url}" width="{width}" />',a))}b.off("click","*");return false})};eva.story=function(){if(!$("#feed-wall")[0]){return false}var a=function(){var d=10;var i=1;var b=$("#feed-wall");var g=$(".load-more");$("body").append('<div id="load-area"></div>');var c=$("#load-area");var e=[];var h=function(k){k.each(function(){var l=$(this);l.addClass("inited");return true})};$(window).resize(function(){b.masonry({itemSelector:".box",isAnimated:true}).masonry("reload")});b.imagesLoaded(function(){b.masonry({itemSelector:".box",isAnimated:true});var k=b.find(".box:not(.inited)");h(k)});c.hide();function j(m,l){if(l.length<1){return false}for(var n=0;n<l.length;n++){var k=l[n];if(k==m){return true}}return false}var f=function(k){if(i>d){return false}var l=k.attr("href");if(j(l,e)){return false}e.push(l);c.load(l+" #feed-wall",function(){var n=c.find(".load-more").attr("href");k.attr("href",n);var m=c.find(".box");c.imagesLoaded(function(){b.append(m).masonry("appended",m,true);h(b.find(".box:not(.inited)"));c.html("");k.removeClass("disabled").html("More")});i++});return false};$(window).scroll(function(){var n=$(document).height();var k=$(window).scrollTop();var l=$(window).height();var m=n-k-l;if(m<300){f(g)}})};eva.loader(eva.s(["/lib/js/jquery/jquery.masonry.js","/lib/js/jquery/jquery.mousewheel.js","/lib/js/jquery/jquery.jscrollpane.js"]),a)};eva.refreshOnline=function(){var a=function(){$.ajax({url:eva.d("/user/refresh/online/"),type:"get",dataType:"json",success:function(b){}})};a();setInterval(function(){a()},50000)};eva.topSearch=function(){if(!$(".top-search")[0]){return false}var a=$(".top-search");a.find(".dropdown-menu a").on("click",function(){var b=$(this);a.find(".current").html(b.html());a.attr("action",b.attr("data-url"))})};eva.construct=function(){$("#lang").on("change",function(){window.location.href=$(this).val()});eva.highlightmenu();eva.miniCalendar();eva.notice();eva.select2();eva.checkFollow();eva.preview();eva.refreshOnline();eva.story();eva.topSearch();var c=eva.config.lang;var a={en:"en",fr:"fr",zh:"zh_CN",zh_TW:"zh_TW",ja:"ja"};var b=a[c];eva.loader(eva.s("/lib/js/jquery/jquery.validationEngine/jquery.validationEngine-"+b+".js"),function(){$("form").validationEngine()});eva.loader(eva.s("/lib/js/jstemplates/tmpl.js"),function(){eva.templates()});return false};eva.destruct=function(){};
